<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zbahis √áarkƒ± ‚Ä¢ Yanarlƒ± D√∂nerli + Para Efektleri</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --gold:#ffd166; --gold-2:#c9a63a; --gold-3:#fff1b0;
    --txt:#eaf2ff; --bg1:#0d1a2a; --bg2:#091522; --bg3:#070c14;
    --neon:#25FFE6; --neon2:#0DC5FF;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;
    color:var(--txt);
    background:
      radial-gradient(1200px 700px at 50% -10%, rgba(37,255,230,.16), transparent 60%),
      radial-gradient(1200px 700px at 50% 110%, rgba(13,197,255,.12), transparent 60%),
      radial-gradient(circle at 50% 45%, var(--bg1) 0%, var(--bg2) 38%, var(--bg3) 100%);
    display:flex; flex-direction:column; align-items:center; gap:16px; padding:12px 12px 24px;
    overflow-x:hidden;
  }

  /* === PROMO BANNER === */
  .promo{
    width:min(100%, 1040px);
  }
  .promo a{ display:block }
  .promo img{
    width:100%; height:auto; display:block; border-radius:18px;
    object-fit:cover; aspect-ratio: 16 / 6;
    box-shadow:0 20px 60px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.15);
  }

  /* === HEADER === */
  .wrap{ width:min(96vw,1040px); display:grid; gap:16px; place-items:center; position:relative; z-index:1 }
  .brand{ display:flex; align-items:center; gap:12px; filter:drop-shadow(0 0 18px rgba(37,255,230,.24)) }
  .brand img{ width:clamp(150px,22vw,220px); height:auto; object-fit:contain }
  .badge{ font-size:12px; padding:6px 10px; border-radius:999px; letter-spacing:.3px;
    background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.12); color:#cfe6ff }

  /* === STAGE & WHEEL === */
  .stage{ width:min(92vw,560px); aspect-ratio:1/1; position:relative; }
  .aura{ position:absolute; inset:-10%; border-radius:50%;
    background:
      radial-gradient(closest-side, rgba(255,214,102,.26), transparent 60%),
      radial-gradient(closest-side, rgba(37,255,230,.18), transparent 70%);
    filter: blur(20px); z-index:0; animation:auraPulse 3.5s ease-in-out infinite;
  }
  @keyframes auraPulse{ 0%,100%{opacity:.65} 50%{opacity:1} }
  .pointer{
    position:absolute; top:-6px; left:50%; translate:-50% 0; z-index:8;
    width:0; height:0;
    border-left:22px solid transparent; border-right:22px solid transparent; border-bottom:38px solid var(--gold);
    filter: drop-shadow(0 0 12px rgba(255,214,102,.9)) drop-shadow(0 0 20px rgba(255,214,102,.5));
    animation: pointerGlow 1.8s ease-in-out infinite;
  }
  .pointer::after{ content:""; position:absolute; top:26px; left:-18px; width:36px; height:6px; border-radius:6px;
    background:linear-gradient(90deg, #fff8e1, var(--gold)); opacity:.9; filter:blur(.8px); }
  @keyframes pointerGlow{ 0%,100%{filter:drop-shadow(0 0 8px rgba(255,214,102,.6)) drop-shadow(0 0 18px rgba(255,214,102,.35))} 50%{filter:drop-shadow(0 0 16px rgba(255,214,102,.95)) drop-shadow(0 0 26px rgba(255,214,102,.6))} }
  .rim{ position:absolute; inset:0; border-radius:50%; padding:16px; z-index:1;
    background:
      radial-gradient(circle at 35% 30%, rgba(255,255,255,.08), transparent 40%),
      conic-gradient(from 0deg, rgba(255,255,255,.06), rgba(0,0,0,.18) 60%, rgba(255,255,255,.06) 100%),
      linear-gradient(180deg, #283243, #101826);
    box-shadow: inset 0 0 0 3px rgba(255,255,255,.06), inset 0 0 50px rgba(0,0,0,.6), 0 30px 60px rgba(0,0,0,.55);
  }
  .bezel{ position:absolute; inset:12px; border-radius:50%; border:12px solid transparent;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.18), transparent 45%) padding-box,
               linear-gradient(135deg, var(--gold-3), var(--gold) 40%, var(--gold-2)) border-box; z-index:2; }
  .neon-ring{ position:absolute; inset:18px; border-radius:50%; z-index:2; border:6px solid transparent;
    background: conic-gradient(from 0deg, rgba(37,255,230,.0), rgba(37,255,230,.22), rgba(13,197,255,.0) 50%, rgba(13,197,255,.28), rgba(37,255,230,.0)) border-box;
    mask: radial-gradient(farthest-side, transparent calc(100% - 6px), #000 calc(100% - 6px));
    animation:ringSpin 6s linear infinite; filter:blur(1px);
  }
  @keyframes ringSpin{ to{ transform: rotate(360deg) } }
  .wheel{ position:absolute; inset:28px; border-radius:50%; z-index:3; will-change:transform }
  .sweep{ position:absolute; inset:28px; border-radius:50%; z-index:4; mix-blend-mode:screen; pointer-events:none;
    background: conic-gradient(from 0deg, rgba(255,255,255,0) 0 82%, rgba(255,255,255,.22) 86%, rgba(255,255,255,0) 92%, rgba(255,255,255,0) 100%),
               radial-gradient(120% 80% at 50% -10%, rgba(255,255,255,.18), transparent 60%);
    animation: sweepSpin 2.4s linear infinite; opacity:.8;
  }
  @keyframes sweepSpin{ to{ transform: rotate(360deg) } }
  .glass{ position:absolute; inset:28px; border-radius:50%; z-index:5; pointer-events:none;
    background: radial-gradient(120% 80% at 50% -10%, rgba(255,255,255,.20), transparent 60%),
               radial-gradient(80% 60% at 50% 120%, rgba(255,255,255,.08), transparent 50%);
    mix-blend-mode:screen; opacity:.25; }

  /* Merkez LOGO ‚Äì tƒ±klanabilir */
  .hub{ position:absolute; inset:calc(50% - 15%); border-radius:50%; z-index:7;
    display:grid; place-items:center; cursor:pointer;
    background: radial-gradient(circle at 35% 35%, #fff6d4 0%, #ffe08a 25%, var(--gold) 50%, var(--gold-2) 100%);
    border:4px solid rgba(0,0,0,.35);
    box-shadow: inset 0 6px 16px rgba(255,255,255,.55), inset 0 -16px 28px rgba(0,0,0,.45), 0 0 28px rgba(255,214,102,.35);
    overflow:hidden;
  }
  .hub img{ width:72%; height:auto; object-fit:contain; filter:drop-shadow(0 0 8px rgba(0,0,0,.25)); position:relative; z-index:2 }
  .hub::after{ content:""; position:absolute; inset:-20%; border-radius:50%;
    background: conic-gradient(from 0deg, rgba(255,255,255,0) 0 70%, rgba(255,255,255,.22) 78%, rgba(255,255,255,0) 85%, rgba(255,255,255,0) 100%);
    animation: hubShine 2.8s linear infinite; }
  @keyframes hubShine{ to{ transform: rotate(360deg) } }
  .hub:active{ transform:scale(.98) }

  .controls{ display:flex; gap:12px; align-items:center; justify-content:center; margin-top:6px }
  .btn{ cursor:pointer; user-select:none; padding:14px 26px; border:none; border-radius:14px;
    background:linear-gradient(90deg, #ffe28a, #ffb64d); color:#1b1200; font-weight:800; letter-spacing:.5px; font-size:18px;
    box-shadow:0 8px 24px rgba(255,182,77,.35), inset 0 -6px 12px rgba(0,0,0,.2);
    transition:transform .15s ease, opacity .2s ease; }
  .btn:hover{ transform:translateY(-2px) }
  .btn[disabled]{ opacity:.6; cursor:not-allowed }
  .hint{ font-size:12px; color:#bcd4f7; opacity:.8; text-align:center }

  /* Popup */
  .popup{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:20; background:rgba(0,0,0,.7); backdrop-filter:blur(6px) }
  .popup.show{ display:flex }
  .card{ width:min(92vw,560px); border-radius:22px; padding:26px; text-align:center;
    background: radial-gradient(120% 160% at 50% -20%, rgba(37,255,230,.12), transparent 40%),
                linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.12);
    box-shadow:0 18px 60px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.2);
    animation:pop .45s ease; }
  .card img{ width:180px; filter:drop-shadow(0 0 16px rgba(37,255,230,.3)) }
  .card h2{ margin:10px 0 6px; font-size:clamp(20px,3.6vw,28px) }
  .card p{ margin:0; color:#d7eaff }
  .cta{ margin-top:16px; padding:14px 22px; border:none; border-radius:14px; font-weight:800; letter-spacing:.4px; cursor:pointer;
    color:#fff; background:linear-gradient(90deg,#2cf08c,#10b981);
    box-shadow:0 10px 26px rgba(16,185,129,.35), inset 0 -6px 12px rgba(0,0,0,.25); }
  .ghost{ margin-top:10px; padding:10px 16px; border-radius:12px; background:transparent; border:1px solid rgba(255,255,255,.22); color:#e6f2ff; cursor:pointer }
  @keyframes pop{ from{ transform:scale(.9); opacity:0 } to{ transform:scale(1); opacity:1 } }

  /* Confetti & Money layers */
  canvas#confetti{ position:fixed; inset:0; pointer-events:none; z-index:18 }
  #money-layer{ position:fixed; inset:0; pointer-events:none; z-index:19; overflow:hidden }

  /* Money particles */
  .money{ position:fixed; will-change:transform,opacity; }
  .coin{
    width:14px; height:14px; border-radius:50%;
    background:radial-gradient(circle at 30% 30%, #fff6d4, #ffd166 45%, #cfa43b 70%, #8a6a1f 100%);
    box-shadow:0 2px 6px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.6);
    animation: burst 900ms cubic-bezier(.17,.67,.22,1), spin 900ms linear;
  }
  .bill{
    width:34px; height:18px; border-radius:4px;
    background:
      linear-gradient(135deg, rgba(255,255,255,.3), rgba(255,255,255,0)) border-box,
      linear-gradient(180deg, #36d28b, #118a5c) padding-box;
    border:1px solid rgba(0,0,0,.25);
    box-shadow:0 2px 6px rgba(0,0,0,.35);
    position:relative;
    animation: burst 1100ms cubic-bezier(.17,.67,.22,1), wobble 1100ms ease-in-out;
  }
  .bill::after{
    content:"‚Ç∫"; position:absolute; inset:auto auto 2px 6px; font-size:12px; opacity:.7; color:#083d2a;
  }
  @keyframes burst{
    0%{ transform: translate(0,0) scale(0); opacity:0 }
    10%{ opacity:1 }
    100%{ transform: translate(var(--dx), var(--dy)) rotate(var(--rot)); opacity:0 }
  }
  @keyframes spin{ to{ transform: translate(var(--dx), var(--dy)) rotate(calc(var(--rot) + 360deg)) } }
  @keyframes wobble{
    0%{ transform: translate(0,0) scale(0) rotate(0) }
    100%{ transform: translate(var(--dx), var(--dy)) rotate(var(--rot)) }
  }

  /* Money rain */
  .rain{
    animation: rain linear forwards;
    opacity:0;
  }
  @keyframes rain{
    0%{ transform: translate(var(--x), -10vh) rotate(0deg); opacity:0 }
    10%{ opacity:1 }
    100%{ transform: translate(calc(var(--x) + var(--wind)), 110vh) rotate(360deg); opacity:0 }
  }

  @media (max-width:480px){
    .btn{ padding:12px 20px; font-size:16px }
    .promo img{ aspect-ratio: 16 / 9 } /* mobilde banner daha y√ºksek */
  }
</style>
</head>
<body>
  <!-- PROMO BANNER -->
  <div class="promo">
    <a id="bannerLink" href="#" target="_blank" rel="noopener">
      <img id="bannerImg" src="banner.jpg" alt="Kampanya Bannerƒ± (banner.jpg ekleyin)">
    </a>
  </div>

  <div class="wrap">
    <div class="brand">
      <img src="logo.png" alt="Zbahis">
      <span class="badge">Yanarlƒ± D√∂nerli Ultra √áark ‚Ä¢ Zbahis</span>
    </div>

    <div class="stage" aria-live="polite">
      <div class="aura"></div>
      <div class="pointer" aria-hidden="true"></div>
      <div class="rim"></div>
      <div class="bezel"></div>
      <div class="neon-ring"></div>

      <svg class="wheel" id="wheelSvg" viewBox="0 0 1000 1000" aria-label="√ñd√ºl √áarkƒ±"></svg>
      <div class="sweep"></div>
      <div class="glass"></div>

      <div class="hub" id="hubSpin" title="D√∂nd√ºr">
        <img src="logo.png" alt="Zbahis" />
      </div>
    </div>

    <div class="controls">
      <button class="btn" id="spinBtn">√áarkƒ± √áevir</button>
    </div>
    <div class="hint">Her dilimde 1 barem (tƒ±k). Sonu√ß, i≈üaret√ßi altƒ±ndaki dilimle %100 aynƒ±.</div>
  </div>

  <!-- Effects layers -->
  <div id="money-layer"></div>
  <canvas id="confetti"></canvas>

  <!-- Popup -->
  <div class="popup" id="popup" role="dialog" aria-modal="true" aria-labelledby="popTitle">
    <div class="card">
      <img src="logo.png" alt="Zbahis">
      <h2 id="popTitle">Tebrikler! üéâ</h2>
      <p id="resultText">Kazandƒ±nƒ±z: ‚Ä¶</p>
      <button class="cta" id="goSite">Siteye Git</button>
      <button class="ghost" id="closePop">Kapat</button>
    </div>
  </div>

<script>
/* ========= BANNER AYAR ========= */
const BANNER = { img: "banner.jpg", href: "https://zbahis.com/promo" };
const bannerImg = document.getElementById("bannerImg");
const bannerLink = document.getElementById("bannerLink");
if (BANNER.img) bannerImg.src = BANNER.img;
if (BANNER.href) bannerLink.href = BANNER.href;

/* ========= √ñD√úLLER ========= */
const prizes = [
  "üéÅ 1000 TL Nakit",
  "üéÅ 1000 TL Freespin",
  "üéÅ 1000 TL Bonus Buy",
  "üéÅ 1000 TL Freebet",
];
const siteUrl = "https://zbahis.com";

/* ========= √áARK √áƒ∞Zƒ∞M (SVG) ========= */
const svg = document.getElementById("wheelSvg");
const CX=500, CY=500, R_OUT=460, R_IN=120;
const SLICE_COLORS = [
  ["#d83a42","#ff6a74"], ["#20bf6b","#7bed9f"],
  ["#2980b9","#6fb3ff"], ["#f39c12","#ffd66e"]
];

function polarToXY(r, ang){ return [CX + r*Math.sin(ang), CY - r*Math.cos(ang)]; } // 0¬∞ tepe

function buildWheel(){
  svg.innerHTML="";
  const plate = document.createElementNS("http://www.w3.org/2000/svg","circle");
  plate.setAttribute("cx",CX); plate.setAttribute("cy",CY); plate.setAttribute("r",R_OUT);
  plate.setAttribute("fill","#0a1320"); svg.appendChild(plate);

  const N = prizes.length;
  const sliceRad = (Math.PI*2)/N;
  const sepGroup = document.createElementNS(svg.namespaceURI,"g"); svg.appendChild(sepGroup);

  for(let i=0;i<N;i++){
    const startAng=i*sliceRad, endAng=(i+1)*sliceRad, midAng=startAng+sliceRad/2;

    // Dilim path'i
    const [x1,y1]=polarToXY(R_IN,startAng), [x2,y2]=polarToXY(R_OUT,startAng);
    const [x3,y3]=polarToXY(R_OUT,endAng), [x4,y4]=polarToXY(R_IN,endAng);
    const largeArc = (sliceRad>Math.PI)?1:0;
    const p = document.createElementNS(svg.namespaceURI,"path");
    p.setAttribute("d",`M${x1} ${y1} L${x2} ${y2} A${R_OUT} ${R_OUT} 0 ${largeArc} 1 ${x3} ${y3} L${x4} ${y4} A${R_IN} ${R_IN} 0 ${largeArc} 0 ${x1} ${y1} Z`);

    // Renk degrade
    const gradId=`g${i}`, grad=document.createElementNS(svg.namespaceURI,"linearGradient");
    grad.setAttribute("id",gradId); grad.setAttribute("x1","0"); grad.setAttribute("y1","0"); grad.setAttribute("x2","1"); grad.setAttribute("y2","1");
    const c=SLICE_COLORS[i%SLICE_COLORS.length];
    grad.innerHTML=`<stop offset="0%" stop-color="${c[0]}"/><stop offset="100%" stop-color="${c[1]}"/>`;
    svg.appendChild(grad); p.setAttribute("fill",`url(#${gradId})`); p.setAttribute("opacity",".98"); svg.appendChild(p);

    // Etiket
    const arcId=`a${i}`, midR=(R_IN+R_OUT)/2;
    const [ax1,ay1]=polarToXY(midR,startAng+0.04), [ax2,ay2]=polarToXY(midR,endAng-0.04);
    const arc=document.createElementNS(svg.namespaceURI,"path");
    arc.setAttribute("id",arcId); arc.setAttribute("d",`M${ax1} ${ay1} A ${midR} ${midR} 0 0 1 ${ax2} ${ay2}`);
    arc.setAttribute("fill","none"); svg.appendChild(arc);
    const label=document.createElementNS(svg.namespaceURI,"text");
    label.setAttribute("fill","#fff"); label.setAttribute("font-size","36"); label.setAttribute("font-weight","800"); label.setAttribute("letter-spacing",".06em");
    const tp=document.createElementNS(svg.namespaceURI,"textPath");
    tp.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",`#${arcId}`); tp.setAttribute("startOffset","50%"); tp.setAttribute("text-anchor","middle");
    tp.textContent=prizes[i].replace("üéÅ ",""); label.appendChild(tp); svg.appendChild(label);

    // Altƒ±n ayƒ±rƒ±cƒ±
    const [sx1,sy1]=polarToXY(R_IN,startAng), [sx2,sy2]=polarToXY(R_OUT,startAng);
    const sep=document.createElementNS(svg.namespaceURI,"line");
    sep.setAttribute("x1",sx1); sep.setAttribute("y1",sy1); sep.setAttribute("x2",sx2); sep.setAttribute("y2",sy2);
    sep.setAttribute("stroke","url(#goldStroke)"); sep.setAttribute("stroke-width","6"); sepGroup.appendChild(sep);

    // Barem (tek peg, dilim ortasƒ±)
    const pegR=R_OUT-10, pegLen=24, pegTh=6;
    const [px,py]=polarToXY(pegR,midAng); const angl=(midAng*180/Math.PI)+90;
    const peg=document.createElementNS(svg.namespaceURI,"rect");
    peg.setAttribute("width",pegLen); peg.setAttribute("height",pegTh); peg.setAttribute("rx","3"); peg.setAttribute("ry","3");
    peg.setAttribute("fill","url(#goldStroke)");
    peg.setAttribute("transform",`translate(${px} ${py}) rotate(${angl}) translate(${-pegLen/2} ${-pegTh/2})`);
    peg.setAttribute("data-peg-angle",(midAng*180/Math.PI).toFixed(4));
    peg.classList.add("peg"); svg.appendChild(peg);
  }

  // Altƒ±n √ßizgi gradyanƒ±
  const gs=document.createElementNS(svg.namespaceURI,"linearGradient");
  gs.setAttribute("id","goldStroke"); gs.setAttribute("x1","0"); gs.setAttribute("y1","0"); gs.setAttribute("x2","1"); gs.setAttribute("y2","1");
  gs.innerHTML=`<stop offset="0%" stop-color="#fff3c2"/><stop offset="35%" stop-color="#ffd166"/><stop offset="60%" stop-color="#cfa43b"/><stop offset="100%" stop-color="#fff0b0"/>`;
  svg.appendChild(gs);
}
buildWheel();

/* ========= SES ========= */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
const actx = new AudioCtx();
function tickSound(){ const o=actx.createOscillator(), g=actx.createGain();
  o.type="square"; o.frequency.value=1200+Math.random()*150;
  g.gain.setValueAtTime(0.07, actx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.0001, actx.currentTime+0.08);
  o.connect(g).connect(actx.destination); o.start(); o.stop(actx.currentTime+0.09);
}
function whoosh(){ const o=actx.createOscillator(), g=actx.createGain();
  o.type="sawtooth"; o.frequency.setValueAtTime(220, actx.currentTime);
  o.frequency.exponentialRampToValueAtTime(40, actx.currentTime+0.7);
  g.gain.setValueAtTime(0.0001, actx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.08, actx.currentTime+0.05);
  g.gain.exponentialRampToValueAtTime(0.0001, actx.currentTime+0.9);
  o.connect(g).connect(actx.destination); o.start(); o.stop(actx.currentTime+0.95);
}
function cashSound(){ // basit ka-ching
  const o1=actx.createOscillator(), o2=actx.createOscillator(), g=actx.createGain();
  o1.type="triangle"; o2.type="square";
  o1.frequency.value=880; o2.frequency.value=1320;
  g.gain.value=0.0001; g.gain.exponentialRampToValueAtTime(0.12, actx.currentTime+0.02);
  g.gain.exponentialRampToValueAtTime(0.0001, actx.currentTime+0.35);
  o1.connect(g); o2.connect(g); g.connect(actx.destination);
  o1.start(); o2.start(); o1.stop(actx.currentTime+0.35); o2.stop(actx.currentTime+0.35);
}

/* ========= CONFETTI ========= */
const confettiCanvas=document.getElementById("confetti");
const cctx=confettiCanvas.getContext('2d');
function resizeC(){ confettiCanvas.width=innerWidth; confettiCanvas.height=innerHeight; }
addEventListener('resize',resizeC); resizeC();
let flakes=[];
function confettiBurst(x=innerWidth/2,y=innerHeight/2,n=140){
  flakes=[];
  for(let i=0;i<n;i++){
    flakes.push({x,y,vx:(Math.random()*2-1)*6,vy:(Math.random()*2-1)*6-3,g:0.18+Math.random()*0.08,
      s:3+Math.random()*3,a:Math.random()*Math.PI*2,va:Math.random()*.2-.1,
      c:i%3? (i%3===1?"#25FFE6":"#0DC5FF"):"#ffd166"});
  }
  (function loop(){
    cctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    flakes.forEach(f=>{ f.vy+=f.g; f.x+=f.vx; f.y+=f.vy; f.a+=f.va;
      cctx.save(); cctx.translate(f.x,f.y); cctx.rotate(f.a);
      cctx.fillStyle=f.c; cctx.fillRect(-f.s/2,-f.s/2,f.s,f.s*1.6);
      cctx.restore();
    });
    flakes = flakes.filter(f=> f.y < confettiCanvas.height+20);
    if(flakes.length) requestAnimationFrame(loop);
  })();
}

/* ========= PARA EFEKTLERƒ∞ ========= */
const moneyLayer = document.getElementById('money-layer');

function spawnMoneyBurst(x=innerWidth/2, y=innerHeight/2){
  const total = 24; // karma: coin+bill
  for(let i=0;i<total;i++){
    const isCoin = Math.random() < 0.6;
    const el = document.createElement('div');
    el.className = `money ${isCoin ? 'coin' : 'bill'}`;
    const dx = (Math.random()*2-1) * (140 + Math.random()*120);
    const dy = (-60 - Math.random()*160) + (Math.random()*80);
    const rot = (Math.random()*720-360) + 'deg';
    el.style.left = x + 'px'; el.style.top = y + 'px';
    el.style.setProperty('--dx', dx+'px');
    el.style.setProperty('--dy', dy+'px');
    el.style.setProperty('--rot', rot);
    moneyLayer.appendChild(el);
    el.addEventListener('animationend', ()=> el.remove(), {once:true});
  }
}

function spawnMoneyRain(){
  const rows = Math.min(24, Math.ceil(innerWidth/60));
  for(let i=0;i<rows;i++){
    const isCoin = Math.random() < 0.5;
    const el = document.createElement('div');
    el.className = `money ${isCoin ? 'coin' : 'bill'} rain`;
    const x = Math.random()*innerWidth*0.95;
    const wind = (Math.random()*2-1)*120 + 'px';
    const duration = 2000 + Math.random()*2200;
    el.style.setProperty('--x', x+'px');
    el.style.setProperty('--wind', wind);
    el.style.animationDuration = duration + 'ms';
    moneyLayer.appendChild(el);
    el.addEventListener('animationend', ()=> el.remove(), {once:true});
  }
}

/* ========= SPIN ========= */
const spinBtn=document.getElementById("spinBtn");
const hubSpin=document.getElementById("hubSpin");
const popup=document.getElementById("popup");
const resultText=document.getElementById("resultText");
const goSite=document.getElementById("goSite");
const closePop=document.getElementById("closePop");

let currentDeg=0, spinning=false;
const N = prizes.length;
const sliceDeg = 360 / N;
const pegs=[...svg.querySelectorAll(".peg")].map(el=>parseFloat(el.getAttribute("data-peg-angle"))); // 0..360
function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

function spin(){
  if(spinning) return;
  spinning=true; spinBtn.disabled=true;
  if(actx.state==="suspended") actx.resume();

  // hedef dilim ve tepe hizasƒ±
  const targetIndex=Math.floor(Math.random()*N);
  const destCenter = targetIndex*sliceDeg + sliceDeg/2;
  const extraTurns = 5 + Math.floor(Math.random()*2); // 5-6 tur
  const finalDeg = extraTurns*360 + (360 - destCenter);

  const startDeg = currentDeg % 360;
  const delta = finalDeg - startDeg;
  const dur = 5600;
  const t0 = performance.now();
  let lastTickDeg=startDeg;

  whoosh();

  function frame(now){
    const t = Math.min(1,(now - t0)/dur);
    const k = easeOutCubic(t);
    const ang = startDeg + delta*k;
    svg.style.transform = `rotate(${ang}deg)`;

    // peg tƒ±kƒ±
    const prog=(ang%360+360)%360, lastProg=(lastTickDeg%360+360)%360;
    for(const p of pegs){
      const crossed = lastProg < p && prog >= p || (lastProg > prog && (prog >= p || lastProg < p));
      if(crossed){ tickSound(); break; }
    }
    lastTickDeg=ang;

    if(t<1){ requestAnimationFrame(frame); }
    else{
      currentDeg = finalDeg;

      // DOƒûRU SONU√á: tepedeki dilim
      const A = ((currentDeg % 360) + 360) % 360;
      const topAngle = ((-A % 360) + 360) % 360;
      const landedIndex = Math.floor(topAngle / sliceDeg) % N;

      resultText.textContent = "Kazandƒ±nƒ±z: " + prizes[landedIndex]";
      popup.classList.add("show");
      cashSound();
      confettiBurst();
      // Para efektleri
      const centerRect = document.querySelector('.stage').getBoundingClientRect();
      spawnMoneyBurst(centerRect.left + centerRect.width/2, centerRect.top + centerRect.height/2);
      setTimeout(spawnMoneyRain, 200);

      spinning=false; spinBtn.disabled=false;
    }
  }
  requestAnimationFrame(frame);
}

/* ========= ETKƒ∞LE≈ûƒ∞M ========= */
spinBtn.addEventListener("click", spin);
hubSpin.addEventListener("click", spin);
goSite.addEventListener("click", ()=> location.href = siteUrl );
closePop.addEventListener("click", ()=> popup.classList.remove("show") );
popup.addEventListener("click", e=>{ if(e.target===popup) popup.classList.remove("show"); });
document.addEventListener("keydown", e=>{
  if((e.key===" "||e.key==="Enter") && !spinning){ e.preventDefault(); spin(); }
});
</script>
</body>
</html>
